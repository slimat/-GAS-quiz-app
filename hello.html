<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>
</head>
<body>
    <p id="qNum">おはよう</p>
    <p id='qSentence'>こんにちは</p> <!-- 問題文を取得 -->
    <ol>
        <li id='q1'></li> <!-- 選択肢1を表示 -->
        <li id='q2'></li>
        <li id='q3'></li>
        <li id='q4'></li>
    </ol>

    <input type="button" id="Button1" value="1" onclick="ansButtonClicked(this.value)">
    <input type="button" id="Button2" value="2" onclick="ansButtonClicked(this.value)">
    <input type="button" id="Button3" value="3" onclick="ansButtonClicked(this.value)">
    <input type="button" id="Button4" value="4" onclick="ansButtonClicked(this.value)">

    <p id='CorrectOrMiss'></p>
    <input type="button" id="next" value="次に進む">

    <script>

    var countObj = {
        count: 0,
        countPlus: function() {++this.count}
    };

    var closer = function(){
        let b = 0;
        return function(plusOr){
            if (plusOr == 1){
                return ++b;
            }else{
                return b;
            }
        };
    }();

    async function ansButtonClicked(clickedNum){ // 回答ボタンがクリックされたときに, 正解・不正解を表示
        await google.script.run.withSuccessHandler(dispCorrectOrMiss).withFailureHandler(failedAccess).withUserObject(countObj.count, 'answerButtonClick').answerButtonClick(clickedNum, countObj.count)
        await document.getElementById("next").addEventListener("onclick", proceedNext);
    }

    async function proceedNext(){
        countObj.countPlus();
        try {
            await google.script.run.withSuccessHandler(returnQInfo).withFailureHandler(failedAccess).withUserObject(countObj.count, 'QAInfo').QAInfo(countObj.count);
        } catch (e) {
            document.getElementById("Button4").insertAdjacentHTML('afterend','<p>error → hello.html → 問題文など取得時 → ' + e.message + '</p>');
        }
    }

    function returnQInfo(data, d){
        //                document.getElementById("Button4").insertAdjacentHTML('afterend','<p>returnQInfoは実引数の受け取りに成功した : ' + data[0][0] + '</p>');
        $("#qNum").html('問題' + d);
        $("#qSentence").html(data[0][0]);
        for (var j=1; j<=4; ++j){
            $("#q" + j).html(data[0][j]);
        }
    }

    function dispCorrectOrMiss(CorrectOrMiss){
        if (CorrectOrMiss == 1){
            $("#CorrectOrMiss").html('正解');
        } else {
            $("#CorrectOrMiss").html('不正解');
        }

    }

    function failedAccess(numQ, functionName){
        document.getElementById("Button4").insertAdjacentHTML('afterend','<p>missed to call' + functionName +  numQ + '</p>');
    }

    try {
        let count = 0;
        do {
            // document.getElementById("Button4").insertAdjacentHTML('afterend','<p>1であれば問題なし = ' + closer(0) + '</p>');
            // ++count;
            proceedNext();
        } while (count == 10);
    } catch (k) {
        document.getElementById("Button4").insertAdjacentHTML('afterend','<p>error → hello.html → do while文中→ ' + k.message + '</p>');
    }
    </script>
</body>
</html>
